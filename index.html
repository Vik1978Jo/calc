<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Fassadenbretter-Rechner</title>
<style>
  :root{--bg:#fff;--fg:#111;--muted:#6b7280;--pri:#2563eb;--bd:#e5e7eb;}
  *{box-sizing:border-box;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial,sans-serif}
  body{margin:0;background:var(--bg);color:var(--fg)}
  .wrap{max-width:940px;margin:12px auto;padding:12px}
  h2{margin:.25rem 0 .75rem}
  .grid{display:grid;gap:12px}
  .card{border:1px solid var(--bd);border-radius:12px;padding:12px}
  label{font-size:.9rem;color:var(--muted)}
  input,select,button{font-size:1rem}
  input[type=number],select{width:100%;padding:10px;border:1px solid var(--bd);border-radius:10px}
  .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
  .row3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px}
  .btn{padding:10px 14px;border:1px solid var(--bd);border-radius:10px;background:#f9fafb;cursor:pointer}
  .btn.primary{background:var(--pri);color:#fff;border-color:var(--pri)}
  .len-list{display:flex;flex-wrap:wrap;gap:8px}
  .len-list .btn{min-width:72px;text-align:center}
  .counter{display:flex;align-items:center;gap:8px}
  .counter .btn{width:40px;height:40px;padding:0}
  .pill{display:inline-block;padding:6px 10px;border:1px solid var(--bd);border-radius:999px;font-size:.9rem}
  .result{display:grid;grid-template-columns:repeat(4,1fr);gap:12px}
  .result .card{padding:10px;text-align:center}
  .muted{color:var(--muted);font-size:.9rem}
  .walls{display:grid;gap:8px}
  .wall-item{display:flex;justify-content:space-between;align-items:center;padding:8px;border:1px dashed var(--bd);border-radius:10px}
  .wall-item .info{font-size:.95rem}
  .wall-item .del{color:#b91c1c;cursor:pointer;border:none;background:transparent}
  @media (max-width:720px){.row,.row3,.result{grid-template-columns:1fr}.len-list .btn{flex:1}}
</style>
</head>
<body>
<div class="wrap">
  <h2>Fassadenbretter-Rechner</h2>

  <!-- Kategorie / Position / Richtung / Längen / Verschnitt -->
  <div class="card grid">
    <div class="row">
      <div>
        <label>Kategorie</label>
        <select id="ddCategory"></select>
      </div>
      <div>
        <label>Position</label>
        <select id="ddPosition"></select>
      </div>
    </div>

    <div class="row">
      <div>
        <label>Brettlänge wählen</label>
        <div id="lenButtons" class="len-list"></div>
      </div>
      <div>
        <label>Richtung</label><br/>
        <label><input type="radio" name="dir" value="H" checked> Horizontal</label>
        &nbsp;&nbsp;
        <label><input type="radio" name="dir" value="V"> Vertikal</label>
      </div>
    </div>

    <div class="row">
      <div>
        <label>Verschnitt: <span id="lblCut">10%</span></label>
        <input id="sldCut" type="range" min="5" max="15" step="1" value="10"/>
      </div>
      <div><span class="muted">Preis deaktiviert (—)</span></div>
    </div>
  </div>

  <!-- Wände -->
  <div class="card grid">
    <label>Wände</label>
    <div class="row">
      <div><input id="inpWL" type="number" step="0.01" placeholder="Länge (m)"></div>
      <div><input id="inpWH" type="number" step="0.01" placeholder="Höhe (m)"></div>
    </div>
    <div class="row">
      <div><label><input id="chkG" type="checkbox"> Giebel hinzufügen</label></div>
      <div><input id="inpGH" type="number" step="0.01" placeholder="Giebelhöhe (m)" disabled></div>
    </div>
    <div><button id="btnAddWall" class="btn">Wand hinzufügen</button></div>
    <div class="walls" id="walls"></div>
  </div>

  <!-- Öffnungen -->
  <div class="card grid">
    <label>Fenster & Türen</label>
    <div class="row3">
      <div class="counter">
        <button class="btn" id="kMinus">−</button>
        <span class="pill">Klein 1×1</span>
        <span id="kCount">0</span>
        <button class="btn" id="kPlus">+</button>
      </div>
      <div class="counter">
        <button class="btn" id="gMinus">−</button>
        <span class="pill">Groß 1,2×1,2</span>
        <span id="gCount">0</span>
        <button class="btn" id="gPlus">+</button>
      </div>
      <div class="counter">
        <button class="btn" id="tMinus">−</button>
        <span class="pill">Tür 1×2,1</span>
        <span id="tCount">0</span>
        <button class="btn" id="tPlus">+</button>
      </div>
    </div>
    <div>
      <label>Zusätzliche Öffnungen (m²)</label>
      <input id="inpExtra" type="number" step="0.01" value="0">
    </div>
  </div>

  <!-- Ergebnis -->
  <div class="card grid">
    <div class="result">
      <div class="card"><div class="muted">Laufmeter</div><div id="outLfm" style="font-weight:600">0</div></div>
      <div class="card"><div class="muted">Stück (nach Richtung)</div><div id="outStk" style="font-weight:600">0</div></div>
      <div class="card"><div class="muted">m³</div><div id="outM3" style="font-weight:600">0</div></div>
      <div class="card"><div class="muted">Preis</div><div id="outPrice" style="font-weight:600">—</div></div>
    </div>
    <div class="muted">Ungefähre Schätzung. Öffnungen werden bei „Stück“ nicht abgezogen (Sicherheitsaufschlag).</div>
    <div><button id="btnCalc" class="btn primary">Berechnen</button></div>
  </div>
</div>

<script>
/* ===== ассортимент БЕЗ цен =====
   Для фасадных позиций задаём: dicke_mm, nutzbreite_mm, laengen (м)
*/
const SORTIMENT = {
  "Schalung": [
    { title:"Schalung mit Nut + Feder 20 x 95 mm",  unit:"m²", dicke_mm:20, nutzbreite_mm:95,  laengen:[3,4,5,6] },
    { title:"Schalung mit Nut + Feder 27 x 135 mm", unit:"m²", dicke_mm:27, nutzbreite_mm:135, laengen:[3,4,5,6] },
    { title:"Schalung mit Nut + Feder 32 x 135 mm", unit:"m²", dicke_mm:32, nutzbreite_mm:135, laengen:[3,4,5,6] },
    { title:"2,4 x 10 cm (Bohlen)",                unit:"lfm", dicke_mm:24, nutzbreite_mm:100, laengen:[3,4,5,6] }
  ],
  "Profilbretter / Riffelbohlen": [
    { title:"27 x 135 mm fein geriffelt", unit:"m²", dicke_mm:27, nutzbreite_mm:135, laengen:[3,4,5,6] },
    { title:"27 x 135 mm grob geriffelt", unit:"lfm", dicke_mm:27, nutzbreite_mm:135, laengen:[3,4,5,6] }
  ],
  "Unbesäumte Bretter": [
    { title:"2,4 cm Breite 15–22 cm", unit:"lfm", dicke_mm:24, nutzbreite_mm:180, laengen:[3,4,5,6] }
  ],
  "Latten": [
    { title:"4 x 6 cm", unit:"lfm", dicke_mm:40, nutzbreite_mm:60, laengen:[3,4,5,6] }
  ]
};

/* ===== константы и состояние ===== */
const FL_KLEIN=1.0, FL_GROSS=1.44, FL_TUER=2.1;
let category=null, position=null, lenM=null, cut=10, direction='H';
let walls=[]; // {L,H,G}
let cK=0,cG=0,cT=0, extra=0;

/* ===== helpers ===== */
const el = id => document.getElementById(id);
const fmt2 = v => (Math.round(v*100)/100).toLocaleString('de-DE');

/* ===== UI ===== */
function init(){
  // категории
  const cats = Object.keys(SORTIMENT);
  el('ddCategory').innerHTML = cats.map(c=>`<option value="${c}">${c}</option>`).join('');
  category = cats[0];
  fillPositions();
  renderLenButtons();

  // события
  el('ddCategory').onchange = ()=>{ category=el('ddCategory').value; fillPositions(); renderLenButtons(); updateAll(); };
  el('ddPosition').onchange = ()=>{ const i=+el('ddPosition').value; position=(SORTIMENT[category]||[])[i]; renderLenButtons(); updateAll(); };
  document.querySelectorAll('input[name="dir"]').forEach(r=>r.onchange=()=>{ direction=r.value; updateAll(); });
  el('sldCut').oninput = e=>{ cut=+e.target.value; el('lblCut').textContent=cut+'%'; updateAll(); };

  el('chkG').onchange=()=>{ el('inpGH').disabled=!el('chkG').checked; if(!el('chkG').checked) el('inpGH').value=''; };
  el('btnAddWall').onclick=()=>{
    const L=+el('inpWL').value, H=+el('inpWH').value, G=el('chkG').checked?+el('inpGH').value:0;
    if(!(L>0 && H>0)) return;
    if(el('chkG').checked && !(G>0)) return;
    walls.push({L,H,G});
    el('inpWL').value=''; el('inpWH').value=''; el('inpGH').value=''; el('chkG').checked=false; el('inpGH').disabled=true;
    renderWalls(); updateAll();
  };

  const upd=()=>{ el('kCount').textContent=cK; el('gCount').textContent=cG; el('tCount').textContent=cT; updateAll(); };
  el('kMinus').onclick=()=>{ cK=Math.max(0,cK-1); upd(); }; el('kPlus').onclick =()=>{ cK++; upd(); };
  el('gMinus').onclick=()=>{ cG=Math.max(0,cG-1); upd(); }; el('gPlus').onclick =()=>{ cG++; upd(); };
  el('tMinus').onclick=()=>{ cT=Math.max(0,cT-1); upd(); }; el('tPlus').onclick =()=>{ cT++; upd(); };
  el('inpExtra').oninput=()=>{ extra=Math.max(0,+el('inpExtra').value||0); updateAll(); };

  el('btnCalc').onclick=updateAll;

  // стартовые данные для наглядности
  walls=[{L:6,H:2.7,G:0}]; renderWalls(); updateAll();
}

function fillPositions(){
  const arr = SORTIMENT[category]||[];
  el('ddPosition').innerHTML = arr.map((p,i)=>`<option value="${i}">${p.title}</option>`).join('');
  position = arr[0];
}

function renderLenButtons(){
  const c=el('lenButtons'); c.innerHTML='';
  const lens = (position && position.laengen) ? position.laengen : [];
  if(lens.length===0){ lenM=null; c.innerHTML='<span class="muted">Keine Längen definiert.</span>'; return; }
  lenM = lens[0];
  lens.forEach(L=>{
    const b=document.createElement('button');
    b.className='btn'+(L===lenM?' primary':''); b.textContent=`${L} m`;
    b.onclick=()=>{ lenM=L; [...c.children].forEach(x=>x.classList.remove('primary')); b.classList.add('primary'); updateAll(); };
    c.appendChild(b);
  });
}

function renderWalls(){
  const cont=el('walls'); cont.innerHTML = walls.length? '' : '<div class="muted">Noch keine Wände hinzugefügt.</div>';
  walls.forEach((w,i)=>{
    const d=document.createElement('div'); d.className='wall-item';
    const info=document.createElement('div'); info.className='info';
    info.textContent=`L ${fmt2(w.L)} m × H ${fmt2(w.H)} m`+(w.G>0?` + Giebel ${fmt2(w.G)} m`:``);
    const del=document.createElement('button'); del.className='del'; del.textContent='Entfernen';
    del.onclick=()=>{ walls.splice(i,1); renderWalls(); updateAll(); };
    d.appendChild(info); d.appendChild(del); cont.appendChild(d);
  });
}

/* ===== расчёт ===== */
function wallArea(w){ return w.L*w.H + (w.G>0 ? 0.5*w.L*w.G : 0); }

function calcPieces(nb_m,len){
  if(!(nb_m>0 && len>0)) return 0;
  let pcs=0;
  for(const w of walls){
    const Hmax = w.H + (w.G>0 ? w.G : 0);
    if(direction==='H'){
      const rows = Math.ceil(Hmax/nb_m);
      const perRow = Math.ceil(w.L/len);
      pcs += rows*perRow;
    }else{
      const cols = Math.ceil(w.L/nb_m);
      const perCol = Math.ceil(Hmax/len);
      pcs += cols*perCol;
    }
  }
  return pcs;
}

function updateAll(){
  if(!position || !position.nutzbreite_mm || !position.dicke_mm || !lenM){
    el('outLfm').textContent='0 lfm'; el('outStk').textContent='0'; el('outM3').textContent='0 m³'; el('outPrice').textContent='—'; return;
  }
  const nb_m = position.nutzbreite_mm/1000;
  const d_m  = position.dicke_mm/1000;

  const sumW = walls.reduce((a,w)=>a+wallArea(w),0);
  const flOpen = cK*FL_KLEIN + cG*FL_GROSS + cT*FL_TUER + (extra||0);
  const netto = Math.max(0, sumW - flOpen);

  const lfm = nb_m>0 ? (netto/nb_m) : 0;
  const lfmCut = lfm*(1+cut/100);
  const m3 = lfmCut*d_m*nb_m;
  const stk = calcPieces(nb_m,lenM);

  el('outLfm').textContent=`${fmt2(lfmCut)} lfm`;
  el('outStk').textContent=`${stk}`;
  el('outM3').textContent =`${fmt2(m3)} m³`;
  el('outPrice').textContent='—';
}

/* ===== старт ===== */
document.addEventListener('DOMContentLoaded', ()=>{
  el('lblCut').textContent='10%';
  init();
  // обновлять при сдвиге слайдера
  el('sldCut').addEventListener('input', e=>{ cut=+e.target.value; el('lblCut').textContent=cut+'%'; updateAll(); });
});
</script>
</body>
</html>
